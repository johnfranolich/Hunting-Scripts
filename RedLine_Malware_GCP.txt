rule RedLine_Malware_used_with_GCP_Yara_Rule {
    author: "John Franolich & Chat Open AI"
	
	comment: "Sources & credits: Google Threat Horizons Report https://services.google.com/fh/files/blogs/gcat_threathorizons_full_jan2023.pdf; https://asec.ahnlab.com/en/29885/ The path & file locations of the local GCP client secrets, access token, SQLite db, bearer token are from SANS SEC488 Author Ryan Nicholson's class.  
	
	Open AI comments are: Note that this rule will only work if the path to the Login Data files is hardcoded into the rule. If the path to the files is variable (e.g., if the username of the user is different on each system), you will need to use a more complex rule to locate the files. Let me know if you have any questions about this!"
	
    strings:
        $login_data = "Login Data" ascii
    condition:
        all of them
    filesize < 50MB and
    (
        filepath contains "Chrome" and filepath contains "User Data" and filepath contains "Default"
        or
        filepath contains "MicrosoftEdge" and filepath contains "User" and filepath contains "Default"
        or
        filepath contains "Opera Software" and filepath contains "Opera Stable"
        or
        filepath contains "Naver" and filepath contains "Naver Whale" and filepath contains "User Data" and filepath contains "Default"
        or
        filepath contains "gcloud" and filepath contains "configuration" and filepath contains "config_default"
        or
        filepath contains "gcloud" and filepath contains "credentials.db"
        or
        filepath contains "gcloud" and filepath contains "access_tokens.db"
    ) and
    $login_data or
    tcp.srcport == 15647 or
    tcp.dstport == 15647
    
}
